<!DOCTYPE html>

<html>
<head>
  <link rel="stylesheet" href="cabinet.css">
  <title>Кабінет користувача</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <h1>Кабінет користувача</h1>
  <h2>Вхід</h2>
  <form>
    <label for="email-login">Email:</label>
    <input type="email" id="email-login" name="email-login" required><br><br>
    <label for="password-login">Пароль:</label>
    <input type="password" id="password-login" name="password-login" required><br><br>
    <button type="submit" onclick="login()">Увійти</button>
  </form>
  <h2>Реєстрація</h2>
  <form>
    <label for="email-register">Email:</label>
    <input type="email" id="email-register" name="email-register" required><br><br>
    <label for="password-register">Пароль:</label>
    <input type="password" id="password-register" name="password-register" required><br><br>
    <label for="email-confirm">Підтвердіть email:</label>
    <input type="email" id="email-confirm" name="email-confirm" required><br><br>
    <button type="submit" onclick="register()">Зареєструватись</button>
  </form>
  

  <script>
    function login() {
  let email = document.getElementById("email-login").value;
  let password = document.getElementById("password-login").value;
  let users = JSON.parse(localStorage.getItem("users")) || [];
  let currentUser = users.find(user => user.email === email && user.password === password);
  if (currentUser) {
    localStorage.setItem("currentUser", JSON.stringify(currentUser));
    localStorage.setItem("discount", "99"); // Зберігаємо знижку у localStorage
    alert("Ви успішно увійшли в систему!");
    window.location.href = "shopping.html"; // Перенаправляємо користувача на "shopping.html"
  } else {
    alert("Неправильний email або пароль!");
  }
}



function register() {
  let email = document.getElementById("email-register").value;
  let password = document.getElementById("password-register").value;
  let emailConfirm = document.getElementById("email-confirm").value;
  let confirmationCode = document.getElementById("confirmation-code").value;

  if (email !== emailConfirm) {
    alert("Електронні адреси не співпадають!");
    return;
  }
  
  let users = JSON.parse(localStorage.getItem("users")) || [];
  let existingUser = users.find(user => user.email === email);
  if (existingUser) {
    alert("Користувач з таким email вже зареєстрований!");
  } else {
    // Перевірка коду підтвердження
    if (confirmationCode !== "12345") {
      alert("Неправильний код підтвердження!");
      return;
    }
    
    let newUser = {email: email, password: password, discount: true};
    users.push(newUser);
    localStorage.setItem("users", JSON.stringify(users));
    localStorage.setItem("currentUser", JSON.stringify(newUser));
    alert("Ви успішно зареєструвалися!");
    
    // Відправлення підтвердження на електронну адресу
    sendConfirmationEmail(email);
    
    window.location.href = "index.html";
  }
}


//---------------не видаляти--------------------------------------------


const sgMail = require('@sendgrid/mail')
sgMail.setApiKey(process.env.SENDGRID_API_KEY)
const msg = {
  to: 'test@example.com', // Change to your recipient
  from: 'test@example.com', // Change to your verified sender
  subject: 'Sending with SendGrid is Fun',
  text: 'and easy to do anywhere, even with Node.js',
  html: '<strong>and easy to do anywhere, even with Node.js</strong>',
}
sgMail
  .send(msg)
  .then(() => {
    console.log('Email sent')
  })
  .catch((error) => {
    console.error(error)
  });


  //----------не видаляти-------------------------------------------

</script>

</body>
</html>"
